---
title: "actions/github-scriptã‚’TypeScriptã¨npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ´»ç”¨ã—ã¦æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["contest2025ts", "githubactions", "typescript"]
published: true
published_at: 2025-06-19 08:00
---

## ã¯ã˜ã‚ã«

GitHub Actionsã® [actions/github-script](https://github.com/actions/github-script) ã€ä½¿ã£ã¦ã¾ã™ã‹ï¼Ÿ
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§JavaScriptã‚³ãƒ¼ãƒ‰ã‚’æ‰‹è»½ã«å®Ÿè¡Œã§ãã¦ä¾¿åˆ©ã§ã™ã‚ˆã­ã€‚
CI/CDã®ã‚³ãƒ¼ãƒ‰ã‚’JavaScriptã§è¨˜è¿°ã§ãã‚‹ãŸã‚ã€Shell scriptã§æ›¸ãã‚ˆã‚Šã‚‚ãƒªãƒƒãƒãªæ§‹æ–‡ã‚„éåŒæœŸå‡¦ç†ãŒæ›¸ãã‚„ã™ããªã£ã¦ã„ã¾ã™ã€‚
ãã‚“ãªä¾¿åˆ©ãªactionã§ã™ãŒã€ä½¿ã£ã¦ã„ã‚‹ã†ã¡ã«ã ã‚“ã ã‚“ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªèª²é¡Œã‚’æ„Ÿã˜ã¦ãã¾ã—ãŸã€‚

- TypeScriptã¯ç›´æ¥ä½¿ç”¨ä¸å¯
- å¤–éƒ¨npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆ©ç”¨ãŒå›°é›£
- å¤§ããªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿å®ˆæ€§ãŒä½ã„

æœ¬è¨˜äº‹ã§ã¯ã€TypeScriptã¨Rollupã‚’æ´»ç”¨ã—ã¦ã“ã‚Œã‚‰ã®åˆ¶ç´„ã‚’è§£æ±ºã—ã€ã‚ˆã‚Šä¿å®ˆã—ã‚„ã™ã„github-scriptã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨

- `actions/github-script` ã®å‡¦ç†ã‚’TypeScriptã§å‹å®‰å…¨ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹
- npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ´»ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹

## å…¨ä½“åƒ

TypeScriptã¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆRollupï¼‰ã‚’ä½¿ã†ã“ã¨ã§ã€ä»¥ä¸‹ã®æµã‚Œã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™

1. github-scriptã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’TypeScriptã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ´»ç”¨ã—ã¦è¨˜è¿°
2. Rollupã§ãƒãƒ³ãƒ‰ãƒ«ã—ã¦CommonJSå½¢å¼ã«å¤‰æ›
3. GitHub Actionsã§ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ

ã“ã‚Œã«ã‚ˆã‚Šã€å‹å®‰å…¨æ€§ã¨npmã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ©æµã‚’å—ã‘ãªãŒã‚‰ã€github-scriptã‚’æœ€å¤§é™ã«æ´»ç”¨ã§ãã¾ã™ã€‚
å‰æã¨ã—ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯yamlã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§æ›¸ãã®ã§ã¯ãªãåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã™æ–¹æ³•ã¨ãªã‚Šã¾ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã¡ã‚‰ã«ç½®ã„ã¦ã„ã¾ã™ã€‚

https://github.com/ikorihn/github-script-ts-bundle

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆä¾‹

ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™

```
.github/
â”œâ”€â”€ scripts/                   # ã“ã“ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã“ã¨ã«ã™ã‚‹
â”‚   â””â”€â”€ example/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ main.ts        # TypeScriptã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚       â”œâ”€â”€ dist/
â”‚       â”‚   â””â”€â”€ bundle.js      # ãƒ“ãƒ«ãƒ‰çµæœï¼ˆè‡ªå‹•ç”Ÿæˆã€gitignoreã™ã‚‹ï¼‰
â”‚       â”œâ”€â”€ package.json       # ä¾å­˜é–¢ä¿‚ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â”œâ”€â”€ rollup.config.js   # Rollupãƒãƒ³ãƒ‰ãƒ«è¨­å®š
â”‚       â””â”€â”€ tsconfig.json      # TypeScriptè¨­å®š
â””â”€â”€ workflows/
    â””â”€â”€ example.yml            # GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```

## å®Ÿè£…æ‰‹é †

### 1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¨­å®š

`package.json`

```json
{
  "name": "example",
  "version": "1.0.0",
  "main": "dist/bundle.js",
  "scripts": {
    "build": "rollup -c"
  },
....
}
```

å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# å‹å®šç¾©ã‚’è£œå®Œã«åˆ©ç”¨ã™ã‚‹ãŸã‚
$ npm install -D @actions/core @actions/github
# rollupã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã¨ã‚‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ npm install -D rollup rollup-plugin-esbuild @rollup/plugin-commonjs @rollup/plugin-node-resolve tslib typescript
# åˆ©ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
$ npm install -S date-fns
```
### 2. TypeScriptã§å‡¦ç†ã‚’è¨˜è¿°

`src/main.ts`

```typescript
import { format, formatDistance, formatRelative, subDays } from "date-fns";
import type { getOctokit } from "@actions/github";
import type { context as ContextType } from "@actions/github";
import type * as Core from "@actions/core";

// å¼•æ•°ã®å‹ã‚’å®šç¾©
type GitHub = ReturnType<typeof getOctokit>;
type Context = typeof ContextType;

export default async ({
  github,
  context,
  core,
}: {
  github: GitHub;
  context: Context;
  core: typeof Core;
}) => {
  core.info("âœ¨ This script is written in TypeScript!");
  const dateDistance = formatDistance(subDays(new Date(), 3), new Date(), {
    addSuffix: true,
  });
  core.info(`Date distance: ${dateDistance}`);
  // => Date distance: 3 days ago
  const { owner, repo } = context.repo;
  core.info(`Running on repository: ${owner}/${repo}`);
};
```

- `export default` ã§å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- github-scriptã‹ã‚‰æ¸¡ã•ã‚Œã‚‹`github`, `context`, `core`ã®å‹ã‚’æ˜ç¤º
- npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆã“ã®ä¾‹ã§ã¯`date-fns`ï¼‰ã‚’è‡ªç”±ã«ä½¿ç”¨å¯èƒ½

### 3. Rollupè¨­å®š

`rollup.config.js`

```javascript
import { nodeResolve } from "@rollup/plugin-node-resolve";
import esbuild from "rollup-plugin-esbuild";

const isProduction = process.env.NODE_ENV === "production";

export default {
  input: "src/main.ts",
  output: {
    file: "dist/bundle.js",
    format: "cjs", // CommonJSå½¢å¼ã§å‡ºåŠ›ã™ã‚‹
    exports: "default",
  },
  plugins: [
    nodeResolve(),
    esbuild({
      sourceMap: true,
      minify: isProduction,
    }),
  ],
};
```

- github-scriptã‹ã‚‰ã¯requireã§èª­ã¿è¾¼ã‚€ãŸã‚ã€CommonJSå½¢å¼ã§å‡ºåŠ›ã™ã‚‹
- esbuildã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã—ã¦ã„ã‚‹

### 4. tsconfig

`tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020"],
    "module": "ESNext",
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src"]
}
```

### 5. GitHub Actions workflow

`.github/workflows/example.yml`

```yaml
name: "Run TypeScript in github-script"

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  ts-script-job:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./.github/scripts/example
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: "npm"
          cache-dependency-path: ./.github/scripts/example/package-lock.json

      # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: npm install

      # ãƒ“ãƒ«ãƒ‰ -> dist/bundle.js ãŒä½œæˆã•ã‚Œã‚‹
      - name: Build script
        run: npm run build

      # bundleã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œ
      - name: Run bundled TypeScript script
        uses: actions/github-script@v7
        with:
          script: |
            const script = require('./.github/scripts/example/dist/bundle.js');
            return await script({github, context, core});
```

- github-scriptã§ã®å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œæ–¹æ³•ã¯[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/actions/github-script?tab=readme-ov-file#run-a-separate-file)ã‚’å‚ç…§ã™ã‚‹

## å®Ÿè¡Œçµæœ

ä¸Šè¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’commitã—ã¦pushã™ã‚‹ã¨æœŸå¾…é€šã‚Šå®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚

![](/images/d64e12/result.png)

## ãŠã‚ã‚Šã«

TypeScriptã¨Rollupã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€github-scriptã§ã‚ˆã‚Šä½¿ã„ã‚„ã™ãä¿å®ˆã—ã‚„ã™ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
åˆæœŸè¨­å®šã¯è‹¥å¹²è¤‡é›‘ã§ã™ãŒã€GitHub APIã®å‹å®šç¾©ãªã©ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã€è¤‡é›‘ãªå‡¦ç†ã§ã‚ã£ã¦ã‚‚GitHub Actionsã«çµ„ã¿è¾¼ã¿ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚
CI/CDè‡ªä½“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®‰å…¨ã«è¡Œã†ãŸã‚ã«ãœã²æ´»ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ï¼
