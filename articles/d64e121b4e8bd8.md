---
title: "actions/github-scriptã§TypeScriptã¨npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ´»ç”¨ã™ã‚‹"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["contest2025ts", "githubactions", "typescript"]
published: false
---

## ã¯ã˜ã‚ã«

GitHub Actionsã®`actions/github-script`ã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§JavaScriptã‚³ãƒ¼ãƒ‰ã‚’æ‰‹è»½ã«å®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
JavaScriptã§è¨˜è¿°ã§ãã‚‹ãŸã‚ã€Shell scriptã§æ›¸ãã‚ˆã‚Šã‚‚ãƒªãƒƒãƒãªæ§‹æ–‡ã‚„éåŒæœŸå‡¦ç†ãŒæ›¸ãã‚„ã™ããªã£ã¦ã„ã¾ã™ã€‚
ä½¿ã£ã¦ã„ã‚‹ã†ã¡ã«ã ã‚“ã ã‚“ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªèª²é¡Œã‚’æ„Ÿã˜ã¦ãã¾ã—ãŸã€‚

- TypeScriptã¯ç›´æ¥ä½¿ç”¨ä¸å¯
- å¤–éƒ¨npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆ©ç”¨ãŒå›°é›£
- å¤§ããªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿å®ˆæ€§ãŒä½ã„

æœ¬è¨˜äº‹ã§ã¯ã€TypeScriptã¨Rollupã‚’æ´»ç”¨ã—ã¦ã“ã‚Œã‚‰ã®åˆ¶ç´„ã‚’è§£æ±ºã—ã€ã‚ˆã‚Šä¿å®ˆã—ã‚„ã™ã„github-scriptã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨

- TypeScriptã§å‹å®‰å…¨ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹
- npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ´»ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹

## å…¨ä½“åƒ

TypeScriptã¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆRollupï¼‰ã‚’ä½¿ã†ã“ã¨ã§ã€ä»¥ä¸‹ã®æµã‚Œã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™

1. github-scriptã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’TypeScriptã€npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ´»ç”¨ã—ã¦è¨˜è¿°
2. Rollupã§ãƒãƒ³ãƒ‰ãƒ«ã—ã¦CommonJSå½¢å¼ã«å¤‰æ›
3. GitHub Actionsã§ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ

ã“ã‚Œã«ã‚ˆã‚Šã€å‹å®‰å…¨æ€§ã¨npmã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ©æµã‚’å—ã‘ãªãŒã‚‰ã€github-scriptã‚’æœ€å¤§é™ã«æ´»ç”¨ã§ãã¾ã™ã€‚
å‰æã¨ã—ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯yamlã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§æ›¸ãã®ã§ã¯ãªãåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã™æ–¹æ³•ã¨ãªã‚Šã¾ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã¡ã‚‰ã«ç½®ã„ã¦ã„ã¾ã™ã€‚

https://github.com/ikorihn/github-script-bundle

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆä¾‹

ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™

```
.github/
â”œâ”€â”€ scripts/                   # ã“ã“ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã“ã¨ã«ã™ã‚‹
â”‚   â””â”€â”€ example/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ main.ts        # TypeScriptã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚       â”œâ”€â”€ dist/
â”‚       â”‚   â””â”€â”€ bundle.js      # ãƒ“ãƒ«ãƒ‰çµæœï¼ˆè‡ªå‹•ç”Ÿæˆã€gitignoreã™ã‚‹ï¼‰
â”‚       â”œâ”€â”€ package.json       # ä¾å­˜é–¢ä¿‚ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â”œâ”€â”€ rollup.config.js   # Rollupãƒãƒ³ãƒ‰ãƒ«è¨­å®š
â”‚       â””â”€â”€ tsconfig.json      # TypeScriptè¨­å®š
â””â”€â”€ workflows/
    â””â”€â”€ example.yml            # GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```

---

## å®Ÿè£…æ‰‹é †

### 1. TypeScriptã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

`src/main.ts`

```typescript
import { format, formatDistance, formatRelative, subDays } from "date-fns";
import type { getOctokit } from "@actions/github";
import type { context as ContextType } from "@actions/github";
import type * as Core from "@actions/core";

type GitHub = ReturnType<typeof getOctokit>;
type Context = typeof ContextType;

export default async ({
  github,
  context,
  core,
}: {
  github: GitHub;
  context: Context;
  core: typeof Core;
}) => {
  core.info("âœ¨ This script is written in TypeScript!");
  const dateDistance = formatDistance(subDays(new Date(), 3), new Date(), {
    addSuffix: true,
  });
  core.info(`Date distance: ${dateDistance}`);
  // => Date distance: 3 days ago
  const { owner, repo } = context.repo;
  core.info(`Running on repository: ${owner}/${repo}`);
};
```

ãƒã‚¤ãƒ³ãƒˆ
- `export default`ã§é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- github-scriptã‹ã‚‰æ¸¡ã•ã‚Œã‚‹`github`, `context`, `core`ã®å‹ã‚’æ˜ç¤º
- npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆã“ã®ä¾‹ã§ã¯`date-fns`ï¼‰ã‚’è‡ªç”±ã«ä½¿ç”¨å¯èƒ½

### 2. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¨­å®š

`package.json`

```json
{
  "name": "example",
  "version": "1.0.0",
  "main": "dist/bundle.js",
  "scripts": {
    "build": "rollup -c",
    "build:prod": "NODE_ENV=production rollup -c"
  },

}
```

å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# å‹å®šç¾©ã‚’è£œå®Œã«åˆ©ç”¨ã™ã‚‹ãŸã‚
$ npm install -D @actions/core @actions/github
# rollupã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã¨ã‚‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ npm install -D rollup rollup-plugin-esbuild @rollup/plugin-commonjs @rollup/plugin-node-resolve tslib typescript
# åˆ©ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
$ npm install -S date-fns
```

### 3. Rollupè¨­å®š

`rollup.config.js`

```javascript
import { nodeResolve } from "@rollup/plugin-node-resolve";
import commonjs from "@rollup/plugin-commonjs";
import esbuild from "rollup-plugin-esbuild";

const isProduction = process.env.NODE_ENV === "production";

export default {
  input: "src/main.ts",
  output: {
    file: "dist/bundle.js",
    format: "cjs",
    exports: "default",
  },
  plugins: [
    nodeResolve(),
    commonjs(),
    esbuild({
      sourceMap: true,
      minify: isProduction,
    }),
  ],
};
```

- CommonJSå½¢å¼ã§å‡ºåŠ›ã™ã‚‹
- esbuildã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã—ã¦ã„ã‚‹ãŒã“ã“ã¯ãªã‚“ã§ã‚‚ã„ã„

### 4. TypeScriptè¨­å®š

`tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020"],
    "module": "ESNext",
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src"]
}
```

### 5. GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

`.github/workflows/example.yml`

```yaml
name: "Run TypeScript in github-script"

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  ts-script-job:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./.github/scripts/example
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: "npm"
          cache-dependency-path: ./.github/scripts/example/package-lock.json
          
      # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹
      - name: Install dependencies
        run: npm install
      - name: Build script
        run: npm run build

      - name: Run bundled TypeScript script
        uses: actions/github-script@v7
        with:
          # å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œæ–¹æ³•ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã™ã‚‹
          # https://github.com/actions/github-script?tab=readme-ov-file#run-a-separate-file
          script: |
            const script = require('./.github/scripts/example/dist/bundle.js');
            return await script({github, context, core});
```

## çµæœ


## ã“ã®æ‰‹æ³•ã®ãƒ¡ãƒªãƒƒãƒˆ

### å‹å®‰å…¨æ€§ã®å‘ä¸Š
- TypeScriptã®æ©æµã‚’å—ã‘ã‚‰ã‚Œã‚‹
- GitHub APIã®å‹å®šç¾©ãŒåˆ©ç”¨å¯èƒ½
- IDEã§ã®è‡ªå‹•è£œå®Œã¨ã‚¨ãƒ©ãƒ¼æ¤œå‡º

### npmã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ´»ç”¨
- è±Šå¯Œãªnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è‡ªç”±ã«ä½¿ç”¨
- è¤‡é›‘ãªå‡¦ç†ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä»»ã›ã‚‰ã‚Œã‚‹
- ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ãŒå‘ä¸Š

### ä¿å®ˆæ€§ã®å‘ä¸Š
- å¤§ããªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²å¯èƒ½
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°ãŒå®¹æ˜“
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®‰å…¨

### é–‹ç™ºä½“é¨“ã®å‘ä¸Š
- ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ãŒå¯èƒ½
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚ã®æ˜ç¢ºåŒ–

---

## æ³¨æ„ç‚¹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹å¯èƒ½æ€§
- ãƒ“ãƒ«ãƒ‰æ™‚é–“ã®å¢—åŠ 
- å¿…è¦ã«å¿œã˜ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’æ¤œè¨

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
- æ©Ÿå¯†æƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å›é¿
- æœ€å°æ¨©é™ã®åŸå‰‡

### ãƒ‡ãƒãƒƒã‚°
- ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
- ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã®æ´»ç”¨
- æ®µéšçš„ãªãƒ­ã‚°å‡ºåŠ›

---

## ã¾ã¨ã‚

TypeScriptã¨Rollupã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€GitHub Actionsã§ã‚ˆã‚Šå¼·åŠ›ã§ä¿å®ˆã—ã‚„ã™ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã§ãã¾ã™ã€‚åˆæœŸè¨­å®šã¯è‹¥å¹²è¤‡é›‘ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªå ´é¢ã§ç‰¹ã«å¨åŠ›ã‚’ç™ºæ®ã—ã¾ã™ï¼š

- è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- å¤–éƒ¨APIã¨ã®é€£æºãŒå¿…è¦ãªå‡¦ç†
- ãƒãƒ¼ãƒ é–‹ç™ºã§ã®ä¿å®ˆæ€§é‡è¦–ã®å ´é¢

ã“ã®æ‰‹æ³•ã«ã‚ˆã‚Šã€GitHub Actionsã®å¯èƒ½æ€§ã‚’å¤§å¹…ã«åºƒã’ã‚‹ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚
